
### Стек технологий и роли серверов

| № | Роль Сервера | ОС | Устанавливаемое ПО | Назначение |
|---|--------------|----|-------------------|------------|
| 1 | **Frontend** (Wiki-сервер) | Ubuntu 22.04 | Nginx, Node.js, Wiki.js, SSL (Let's Encrypt) | Хостинг веб-интерфейса Wiki-системы. Доступ по HTTPS. |
| 2 | **Backend** (Сервер БД) | Ubuntu 22.04 | PostgreSQL 15+ | Основная база данных для Wiki.js и Zabbix Server. |
| 3 | **Monitoring** (Сервер мониторинга) | Ubuntu 22.04 | Zabbix Server (на PostgreSQL), Zabbix Agent, Postfix | Мониторинг метрик всех серверов (CPU, RAM, Disk, Network) и отправка алертов на email. |
| 4 | **Logging** (Сервер сбора логов) | Ubuntu 22.04 | ELK Stack (Elasticsearch, Logstash, Kibana) | Централизованный сбор, анализ и визуализация логов со всех серверов. |
| 5 | **Backup** (Сервер резервного копирования) | Ubuntu 22.04 | PostgreSQL репликация (slave), rsync, cron | 1) **Репликация БД:** Постоянная синхронизация с Backend-сервером. 2) **Резервное копирование файлов:** Регулярное копирование конфигов и данных с других серверов. |


### Схема инфраструктуры и взаимодействий

```
+-----------------------------------------------------------------------------------------+
|                               ВИРТУАЛЬНАЯ СРЕДА (VirtualBox)                           |
|                                                                                         |
|  +-------------+    HTTPS (443)    +----------------+    SQL (5432)    +-------------+  |
|  |  VM1:       | <---------------->|  VM2:          | <----------------|  VM3:       |  |
|  |  Frontend   |                   |  Backend       |                  |  Monitoring |  |
|  |  (Wiki.js)  |                   |  (PostgreSQL)  |                  |  (Zabbix)   |  |
|  +-------------+   (Запросы к API) +----------------+   (Данные для    +-------------+  |
|          |                              |  (Репликация)       мониторинга)      |       |
|          | (Отправка логов)             |                    | (Отправка логов)  |       |
|          |                              |                    |                  |       |
|  +-------------+    (Копирование файлов и БД)      +----------------+            |       |
|  |  VM5:       | <--------------------------------|  VM4:          |            |       |
|  |  Backup     |                                  |  Logging       | <-----------+       |
|  |  Server     |    (PostgreSQL Streaming Rep.)   |  (ELK Stack)   | (Сбор логов)        |
|  +-------------+                                  +----------------+                     |
|          |                                                                               |
|          | (Восстановление по команде)                                                    |
|          +-------------------------------------------------------------------+           |
|                                                                              |           |
+-----------------------------------------------------------------------------------------+
                                                                                |
                                                                                |
                                                                        [ Ansible Control Node ]
                                                                        (Ваш ноутбук с Debian 12)
                                                                        Управляет всей конфигурацией
```

### Ключевые взаимодействия (порты и данные)

| Направление | Протокол/Порт | Описание | Копируемые каталоги (для VM5) |
|-------------|---------------|----------|-------------------------------|
| **Пользователь → VM1** | `HTTPS (443)` | Доступ к веб-интерфейсу Wiki.js | - |
| **VM1 → VM2** | `TCP 5432` | Запросы Wiki.js к базе данных PostgreSQL | - |
| **VM3 → VM2** | `TCP 5432` | Zabbix Server хранит данные мониторинга в PostgreSQL | - |
| **VM3 → Все VM** | `TCP 10050` | Zabbix Server опрашивает Zabbix Agents на всех машинах | - |
| **Все VM → VM4** | `TCP 5044` | Filebeat отправляет логи на Logstash | - |
| **Пользователь → VM4** | `TCP 5601` | Доступ к веб-интерфейсу Kibana | - |
| **Пользователь → VM3** | `TCP 80/443` | Доступ к веб-интерфейсу Zabbix | - |
| **VM5 → VM2** | `TCP 5432` | Постоянная потоковая репликация PostgreSQL (Hot Standby) | - |
| **VM5 → VM1** | `SSH (22)` | Rsync-копирование критичных файлов | `/etc/nginx`, `/opt/wiki.js`, `/home/` |
| **VM5 → VM2** | `SSH (22)` | Rsync-копирование критичных файлов | `/etc/postgresql`, `/var/lib/postgresql` (конфиги) |
| **VM5 → VM3** | `SSH (22)` | Rsync-копирование критичных файлов | `/etc/zabbix`, `/usr/share/zabbix` |
| **VM5 → VM4** | `SSH (22)` | Rsync-копирование критичных файлов | `/etc/elasticsearch`, `/etc/logstash`, `/etc/kibana` |
| **Ansible → Все VM** | `SSH (22)` | Управление конфигурацией всех серверов | - |